# ============================================================================
# PERFORMANCE OPTIMIZATION ENVIRONMENT VARIABLES
# ============================================================================
# Copy relevant variables to your .env file

# ============================================================================
# REDIS CACHING (Optional - app works without it)
# ============================================================================

# Local development
REDIS_URL=redis://localhost:6379

# Railway production (get this from Railway Redis service)
# REDIS_URL=redis://default:password@host:port

# Enable/disable Redis caching (default: true)
REDIS_ENABLED=true

# ============================================================================
# PERFORMANCE MONITORING (Optional)
# ============================================================================

# Enable performance tracking middleware
ENABLE_PERFORMANCE_TRACKING=true

# Slow request threshold in milliseconds (default: 1000)
SLOW_REQUEST_THRESHOLD=1000

# Very slow request threshold in milliseconds (default: 3000)
VERY_SLOW_REQUEST_THRESHOLD=3000

# ============================================================================
# CACHE TTL CONFIGURATION (Optional - uses defaults if not set)
# ============================================================================

# Cache TTL in seconds
CACHE_TTL_SHORT=60          # 1 minute - rapidly changing data
CACHE_TTL_MEDIUM=300        # 5 minutes - search results, lists
CACHE_TTL_LONG=3600         # 1 hour - user ratings, stats
CACHE_TTL_VERY_LONG=86400   # 24 hours - static data (cities)

# ============================================================================
# DATABASE OPTIMIZATION (Already configured in main .env)
# ============================================================================

# Connection pool settings are in config/db.js
# Production: max: 20 connections
# Development: max: 10 connections

# ============================================================================
# EXAMPLE COMPLETE .env FILE
# ============================================================================

# Uncomment and copy to .env:

# # Server
# PORT=5001
# NODE_ENV=development
#
# # Database
# DATABASE_URL=postgresql://user:password@localhost:5432/toosila
# # Or individual vars:
# DB_HOST=localhost
# DB_PORT=5432
# DB_NAME=toosila
# DB_USER=postgres
# DB_PASSWORD=yourpassword
# DB_SSL=false
#
# # Redis (Optional)
# REDIS_URL=redis://localhost:6379
# REDIS_ENABLED=true
#
# # Performance (Optional)
# ENABLE_PERFORMANCE_TRACKING=true
# SLOW_REQUEST_THRESHOLD=1000
#
# # JWT
# JWT_SECRET=your-secret-key-here
# JWT_EXPIRES_IN=7d
#
# # Frontend
# FRONTEND_URL=http://localhost:3000
#
# # Email (if using email features)
# EMAIL_HOST=smtp.gmail.com
# EMAIL_PORT=587
# EMAIL_USER=your-email@gmail.com
# EMAIL_PASSWORD=your-app-password
#
# # Sentry (Optional - for error tracking)
# SENTRY_DSN=https://your-sentry-dsn

# ============================================================================
# PERFORMANCE TESTING
# ============================================================================

# For load testing, server should be running at:
# http://localhost:5001

# Run tests with:
# npm run load:quick    # Quick test (1 min)
# npm run load:test     # Full test (5 min)
# npm run load:stress   # Stress test (10 min)

# ============================================================================
# PRODUCTION DEPLOYMENT (Railway)
# ============================================================================

# Railway automatically provides:
# - DATABASE_URL (from PostgreSQL service)
# - REDIS_URL (from Redis service)
# - PORT (assigned by Railway)

# You need to manually add:
# - JWT_SECRET
# - FRONTEND_URL
# - Other app-specific variables

# ============================================================================
# REDIS INFORMATION
# ============================================================================

# Redis is OPTIONAL. The app will work without it.
#
# Without Redis:
# - No caching (all requests hit database)
# - Slightly slower response times
# - Higher database load
# - Still fully functional
#
# With Redis:
# - 50-70% cache hit rate
# - 90-95% faster cached responses
# - 50-70% reduced database load
# - Better scalability
#
# Cost: ~$5-10/month on Railway

# ============================================================================
# MONITORING REDIS
# ============================================================================

# Check Redis connection:
# redis-cli ping
# Should return: PONG

# View Redis stats:
# redis-cli INFO

# View cached keys:
# redis-cli KEYS *

# Clear cache:
# redis-cli FLUSHDB

# ============================================================================
# TROUBLESHOOTING
# ============================================================================

# If Redis won't connect:
# 1. Check REDIS_URL is correct
# 2. Check Redis server is running: redis-cli ping
# 3. Check firewall isn't blocking port 6379
# 4. Or disable Redis: REDIS_ENABLED=false

# If performance is still slow:
# 1. Run database migration: npm run db:migrate:006
# 2. Check database indexes: See logs after migration
# 3. Monitor slow queries: Check logs/performance.log
# 4. Run load tests: npm run load:quick

# If cache isn't working:
# 1. Check Redis is connected (logs should show "Redis: Successfully connected")
# 2. Check cache headers: curl -I http://localhost:5001/api/offers
# 3. Look for X-Cache: HIT or MISS header
# 4. Check cache stats: curl http://localhost:5001/api/admin/cache/stats

# ============================================================================
